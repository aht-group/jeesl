<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:aht="http://ahtutils.sourceforge.net/jsf"
	xmlns:aup="http://ahtutils.sourceforge.net/prototype"
	xmlns:aupAdm="http://ahtutils.sourceforge.net/prototype/admin"
	xmlns:composite="http://java.sun.com/jsf/composite">
	
	<composite:interface>
		<composite:attribute name="bean" required="true"/>
		<composite:attribute name="domains" required="false"/>
		
		<composite:attribute name="staffTableHeader" required="false" default="#{msg.aupSecurityStaffs}"/>
		
		<composite:facet name="domainColumns" required="true"/>
		<composite:facet name="domainDetail" required="true"/>
	</composite:interface>
	
	<composite:implementation>
		<aup:grid>
	        <aht:row id="row1">
	            <aht:slot width="3">
		            <h:form>
		                <p:dataTable var="var" value="#{cc.attrs.domains}"
		                			selection="#{cc.attrs.bean.domain}" selectionMode="single" rowKey="#{var.id}">
		                    <p:ajax event="rowSelect" update=":#{cc.id}:sStaff :#{cc.id}:sUser" listener="#{cc.attrs.bean.selectDomain()}"/>
		                    <composite:renderFacet name="domainColumns"/>
							<composite:insertChildren/>
		                </p:dataTable>
		            </h:form>
		        </aht:slot>
		        <aht:slot id="sStaff" width="5" renderChildrenIfEjb="#{cc.attrs.bean.domain}">
		            <h:form>
		                <p:dataTable var="staff" value="#{cc.attrs.bean.staffs}"
		                             selection="#{cc.attrs.bean.staff}" selectionMode="single" rowKey="#{staff.id}">
		   					<f:facet name="header">
	                            <aht:pfDataTableHeader title="#{cc.attrs.staffTableHeader}">
	                                <aht:icon type="aupAdd" listener="#{cc.attrs.bean.addStaff()}" update=":#{cc.id}:sUser" tooltip="#{msg.ttNew}"/>
	                            </aht:pfDataTableHeader>
	                        </f:facet>
		                    <p:ajax event="rowSelect" update=":#{cc.id}:sUser" listener="#{cc.attrs.bean.selectStaff()}"/>
		                    <p:column headerText="#{msg.aupSecurityRole}">
		                        <h:outputText value="#{staff.role.name[userBean.localeCode].lang}" />
		                    </p:column>
		                    <p:column headerText="#{msg.Name}">
		                        <h:outputText value="#{staff.user.firstName} #{staff.user.lastName}" />
		                    </p:column>
		                </p:dataTable>
		            </h:form>
		        </aht:slot>
	            <aht:slot id="sUser" width="4" renderChildrenIfEjb="#{cc.attrs.bean.staff}">
	                <h:form id="fUser" rendered="#{not empty cc.attrs.bean.staff}">
	                    <p:panel header="#{msg.aupDetails}" styleClass="auPanelWithGrid">
	                        <f:facet name="actions">
	                        	
	                        </f:facet>
	                        <composite:renderFacet name="domainDetail"/>
	                        <p:panelGrid columns="2" columnClasses="auPwg30,auPwg70">

							<p:outputLabel value="#{msg.aupSecurityRole}"/>
                            <p:selectOneMenu value="#{cc.attrs.bean.staff.role}" effect="fade" >
                                <f:selectItems value="#{cc.attrs.bean.roles}" var="r" itemLabel="#{r.name[userBean.localeCode].lang}" itemValue="#{r}"/>
                            </p:selectOneMenu>
	
	                        </p:panelGrid>
	                        <p:messages redisplay="false" severity="warn,error" showSummary="true" showDetail="true" closable="true"/>
	                    </p:panel>
		            </h:form>
		        </aht:slot>
	        </aht:row>
	    </aup:grid>
	</composite:implementation>
</html>