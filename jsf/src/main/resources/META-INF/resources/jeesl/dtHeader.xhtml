<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui"
    xmlns:j="http://www.jeesl.org/jsf" xmlns:jp="http://jsf.jeesl.org/prototype" xmlns:jtp="http://jsf.jeesl.org/prototype/tag"
    xmlns:composite="http://java.sun.com/jsf/composite">
    
	<composite:interface>
		<composite:attribute name="userLocaleCode" required="false" default="#{localeCode}"/>
		<composite:attribute name="fallbackLocale" required="false" default="#{appLabelBean.fallbackLocale}" />
	
		<composite:attribute name="entity" required="false"/>
		<composite:attribute name="code" required="false"/>
		<composite:attribute name="title" required="false"/>
		<composite:attribute name="suffix" required="false" default=""/>
		
		<composite:facet name="header" required="false"/>
	</composite:interface>
        
	<composite:implementation>    	
    	<c:if test="#{empty cc.facets.header}">
    		<c:set var="debugValue" value="#{cc.attrs.entity}:#{cc.attrs.code}"/>
			<c:set var="showDirect" value="#{not empty cc.attrs.title}"/>
    		<c:set var="showEntity" value="#{(not showDirect) and (empty cc.attrs.code)}"/>
    		<c:set var="showCode" value="#{(not showEntity) and (not empty cc.attrs.code)}"/>
    		
			<c:choose>
				<c:when test="#{showEntity and empty appLabelBean.entities[cc.attrs.entity][cc.attrs.userLocaleCode].lang}">
         			<c:set var="showFallback" value="true"/>
         		</c:when>
         		<c:when test="#{showCode and empty appLabelBean.labels[cc.attrs.entity][cc.attrs.code][cc.attrs.userLocaleCode].lang}">
         			<c:set var="showFallback" value="true"/>
         		</c:when>
         		<c:otherwise>
           			<c:set var="showFallback" value="false"/>
				</c:otherwise>
			</c:choose>
			
			<c:choose>
         		<c:when test="#{showDirect}">
         			<c:set var="titleText" value="#{cc.attrs.title}"/>
         		</c:when>
         		<c:when test="#{showEntity}">
         			<c:set var="titleText" value="#{showFallback
         											? empty appLabelBean.entities[cc.attrs.entity][cc.attrs.fallbackLocale.code].lang
         												? debugValue
         												: appLabelBean.entities[cc.attrs.entity][cc.attrs.fallbackLocale.code].lang
         											: appLabelBean.entities[cc.attrs.entity][cc.attrs.userLocaleCode].lang}"/>
         		</c:when>
         		<c:when test="#{showCode}">
         			<c:set var="titleText" value="#{showFallback
         											? empty appLabelBean.labels[cc.attrs.entity][cc.attrs.code][cc.attrs.fallbackLocale.code].lang
         												? debugValue
         												: appLabelBean.labels[cc.attrs.entity][cc.attrs.code][cc.attrs.fallbackLocale.code].lang
         											: appLabelBean.labels[cc.attrs.entity][cc.attrs.code][cc.attrs.userLocaleCode].lang}"/>
         		</c:when>
         		<c:otherwise>
           			<c:set var="titleText" value="Title needs to be defined"/>
				</c:otherwise>
			</c:choose>
			
			<jtp:symbolizer rendered="#{false and showFallback}" value="#{cc.attrs.fallbackLocale}" marginRight="5" />
			<h:outputText rendered="false" value="ULC:#{cc.attrs.userLocaleCode}  D:#{showDirect}  E:#{showEntity}  C:#{showCode}  F:#{showFallback}" class="pf-datatable-header-title"/>
        	<h:outputText value="#{titleText}#{cc.attrs.suffix}" class="pf-datatable-header-title"/>
        </c:if>
        <c:if test="#{not empty cc.facets.header}">
        	<h:outputText value="" class="pf-datatable-header-title"/>
			<composite:renderFacet name="header"/>
		</c:if>
        <div class="pf-datatable-header-actions">
            <composite:insertChildren/>
        </div>
	</composite:implementation>
</html>